---
title: "Interroger Lexique avec R"
author: "Christophe Pallier"
output:
  html_notebook:
    toc: yes
  pdf_document:
    toc: yes
---

## Introduction

Ce document montre comment interroger et manipuler la base [Lexique](http://www.lexique.org) avec la langage R. Merci de signaler d'éventuelles erreurs à <christophe@pallier.org>

Il fait parti du cours [Programmation pour les Sciences Cognitives](https://chrplr.github.io/PCBS/) ou vous pourrez trouver d'autres documents potentiellement intéressants.


## Prérequis 

1. S'ils sont pas déjà installés sur votre ordinateur, vous devrez installer les logiciels [R](https://cran.r-project.org/) et  [R-Studio Desktop](https://www.rstudio.com/products/rstudio/#Desktop).


2. Téléchargez <http://www.lexique.org/databases/Lexique382/Lexique382.zip>

3. Créer un répertoire `Lexique` puis désippez-y le fichier `Lexique382.zip` précédemment téléchargé.

4. Démarrer le programme **Rstudio** 

   Sélectionner le menu `File/New Project`; Choisir "Existing directory" et naviguer jusqu'au répertoire `Lexique` que vous venez de créer; cliquez sur le bouton `create project`. 
   
   Dans la fenêtre en bas à droite,parmis la liste de fichier sous l'onglet *Files*, vous devez voir `Lexique382.tsv`. Si ce n'est pas le cas, vérifiez que vous avez bien suivi les instructions.

5. Dans la fenêtre en bas à gauche de Rstudio, dans l'onglet *Console*, copier la ligne suivante puis appuez sur 'Entrée'

    install.packages('tidyverse')

Vous êtes prêt !

## Chargement de la table "Lexique.org"

Tout se déroule dans Rstudio. Soyez sûr de bien travailler dans le projet "lexique" créé dans la section "prérequis". Après un rdemarrage de rstsudio, utilisez le menu `File/Recent Projects`.

* Cliquez le menu "File / New File / R Notebook". Un document "Untitled" apparait dans le fenetre en haut à gauche. 

* C'est dans ce document que nous allons entrer du code R:

  Déplacez vous à la ligne 5 (après la ligne contenant '---'), et cliquez sur le bouton *Insert* puis choisisez *R* (vous pouvez aller plus vite en appuyant sur *Ctrl+Alt+I*). 
  
  Copiez les trois lignes suivantes dans le bloc de code qui vient d'être créé. 

```{r}
    require(tidyverse)  # you must have ran "install.packages('tidyverse')" earlier
    lexique = read_delim("Lexique382.tsv", delim="\t")
    head(lexique, 25)
```

   Puis, en faisant bien attention que le curseur soit à l'intérieur du bloc de code, cliquer sur *Run / Run current chunk* (ou bien appuyer sur la petite *fleche verte*, ou sur *Ctrl-Shift-Enter*). Vous devriez voir le première lignes de la table lexique"82 s'afficher.


## Sélection de mots entiers


Supposons que vous vouliez extraire les lignes de lexiques correspondant, par exemple, aux mots 'bateau', 'avion', 'maison', 'arbre'. Le code suivant fait précisemment cela:


```{r}
items <- c('bateau', 'avion', 'maison', 'arbre')

selection <- subset(lexique, ortho %in% items)

head(selection)
```

Vous pouvez inspecter le contenu de la table `selection` en cliquant sur son nom dans l'onglet Environnment dans la fenetre en haut à droite dans rstudio.


Vous pouvez également sauvegarder cette novuelle table dans un fichier avec la ligne suivante:

```{r}
write_tsv(selection, 'selection.tsv')
```

Notez que les fichiers avec l'extension `csv` (tab-separated-values) peuvent être [ouverts avec Excel](https://rievent.zendesk.com/hc/en-us/articles/360000029172-FAQ-How-do-I-open-a-tsv-file-in-Excel-).


## Sélection par critères

Supposont que vous vouliez sélectionner les noms de 5 lettres, singuliers, de fréquence lexicale (films) comprisent entre 10 et 100.

```{r}
selection = subset(lexique, cgram=='NOM' & nombre != 'p' & nblettres==5 & freqlivres > 10 & freqlivres < 100)
head(selection)
```

## Sélection par "pattern"

### Les expressions régulières

Les expressions regulières, ou **regex**, sont des “patterns” qui permettent de rechercher des mots ayant certaines propriétés. 
Voici quelques exemples d’expressions régulières:

- **`^maison$`** : recherche le mot “maison” exactement
- **`^anti`** : recherche tous les mots commençant par “anti”
- **`^jour$|^nuit$|^matin$|^soir$`** : “jour” ou “nuit” ou “matin” ou “soir” (permet de rechercher une liste de mots)
- **`ion`** : recherche les mots qui contiennent la chaine “ion” dans n’importe quelle position
- **`ion$`** : mots se terminant par “ion”
- **`^pr`** : mots commençant par “pr”
- **`^p..r`$** : mots de quatre lettres commençant par “p”, finisant pas “r”
- **`^p.*r$`** : mots commencant par ‘”p’ et finissant par “r”
- **`[aeiou][aeiou]`** : mots contenant 2 voyelles successives
- **`^[aeiou]`** : mots commençant par une voyelle
- **`^[^aeriou]`** : mots ne commençant pas par une voyelle

Il existe beaucoup de tutoriaux sur les regex sur le web, notamment [celui-ci](http://www.canyouseome.com/guide-regex/). La bible sur le sujet est le livre _[Mastering Regular Expressions](http://regex.info/book.html)_  de Jeff Friedl. 

Une regex décrit un automate de transition à états finis. Le site <https://regexper.com/> vous permet de visualiser l’automate associé à votre regex. Par exemple `[ptk].*[aiou][aiou].?ion$` correspond à l’automate fini:

![](fsa.png)

### Recherches dans R avec grepl

R permet d'effectuer des recherches par pattern grâce à la fonction `grepl`. La syntaxe est `grepl(`_regex_, _variable_`)` pour rechercher les lignes où la variable matche la regex (Voir la [doc R de grepl](https://stat.ethz.ch/R-manual/R-devel/library/base/html/grep.html).

Cette fonction permet de localiser les lignes qui 'matchent' une expression, ou bien, en la niant avec le signe `!`, de supprimer des lignes qui matchent un pattern.

Voici quelques exemples:

* Pour obtenir tous les mots qui finissent par `tion` :

```{r}
lexique %>% filter(grepl("tion$", ortho)) -> selection2
head(selection2)
```

Voous pouvez sauvegarder ces résultats avec la commande `write_tsv(selection2, 'mots-en-tion.tsv')`.

* Pour lister tous les mots contenant un cluster de consonnes plosives, mais pas debut de mot:

```{r}
lexique %>% filter(grepl('.[ptkbdg][ptkbdg]', phon)) -> selection3
head(selection3)
```


L'opérateur `filter`peut être appeler plusieurs fois pour affiner progressivement la recherche. Par exemple, pour obtenir tous les mots de 8 lettres qui ne finissent pas 'ent':
```{r}
lexique %>% filter(nblettres == 8) %>% filter(!grepl("ent$", ortho)) -> selection4
head(selection4)
```



